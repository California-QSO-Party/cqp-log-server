<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>CQP Log Submission Form</title>
  <link rel="icon" href="favicon.ico" sizes="16x16 32x32 40x40 64x64 128x128" type="image/vnd.microsoft.icon">

  <link rel="stylesheet" href="//code.jquery.com/ui/1.11.0/themes/smoothness/jquery-ui.css">
<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
<!-- CSS to style the file input field as button and adjust the Bootstrap progress bars -->
<link rel="stylesheet" href="css/jquery.fileupload.css">
  <link rel="stylesheet" href="css/cqp_style.css">
  <script src="//code.jquery.com/jquery-1.11.1.js" type="text/javascript"></script>
  <script src="//code.jquery.com/ui/1.11.1/jquery-ui.js" type="text/javascript"></script>
  <script src="js/vendor/jquery.ui.widget.js" type="text/javascript"></script>
  <script src="js/jquery.iframe-transport.js" type="text/javascript"></script>
  <script src="js/jquery.fileupload.js" type="text/javascript"></script>
  <script src="http://jqueryvalidation.org/files/dist/jquery.validate.min.js" type="text/javascript"></script>
  <script src="http://jqueryvalidation.org/files/dist/additional-methods.min.js" type="text/javascript"></script>

</head>
<body>
<img  src="images/cqplogo80075.jpg" alt="California QSO Party" /> 
<div id="tabs" style="display: none">
  <ul>
    <li><a href="#tabs-1">Upload or drag-and-drop</a></li>
    <li><a href="#tabs-2">Traditional cut-and-paste</a></li>
  </ul>
  <div id="tabs-1">
    <div id="step-1">
      <p>Uploading a CQP Cabrillo file is as easy as 1, 2, 3.  Please complete all three steps to complete
	your contest entry.</p>
      <h1>Step 1: Upload Cabrillo file</h1>
      <span class="btn btn-success fileinput-button">
        <i class="glyphicon glyphicon-plus"></i>
        <span>Drag and drop Cabrillo file here or click to upload...</span>
        <!-- The file input field used as target for the file upload widget -->
	<input id="fileupload" type="file" name="cabrillofile" multiple="multiple">
      </span>
      <br />
      <div id="progress" class="progress">
        <div class="progress-bar progress-bar-success"></div>
      </div>
    </div>
    <div id="step-2">
      <h1>Step 2: Review Cabrillo file</h1>
      <p>If there are errors, please fix the problems in your Cabrillo
      file on your computer and then upload the fixed Cabrillo
      file.</p>
    </div>
    <div id="step-3">
      <h1>Step 3: Provide Supplemental information</h1>
      <form action="server/upload.fcgi" method="post" id="supplementalForm" accept-charset="UTF-8">
	<input type="hidden" name="logID" value="-1" id="logDBId" class="jForm"/>
	<label for="callsignId" class="inLabel">Callsign*:</label>
	<input type="text" name="callsign" value="" id="callsignId" class="jForm"/><br />
	<label for="emailId" class="inLabel">Email*:</label>
	<input type="email" name="email" id="emailId" class="jForm"/><br/>
	<label for="confirmId" class="inLabel">Confirm Email*:</label>
	<input type="email" name="confirm" id="confirmId" class="jForm"/><br />
	<label for="phoneId" class="inLabel">Phone Number*:</label>
	<input type="text" name="phone" id="phoneId" class="jForm"/><br />
	<label for="sentQTHId" class="inLabel">Sent QTH:</label>
	<input type="text" name="sentQTH" id="sentQTHId" class="jForm"/><br />
	<label for="opclassId" class="inLabel">Entry class:</label>
	<select name="opclass" id="opclassId" class="jForm">
	  <option value="single">Single-op</option>
	  <option value="multi-single">Multi-single</option>
	  <option value="multi-multi" selected="selected">Multi-multi</option>
	  <option value="checklog" >Checklog</option>
	</select>
	<select name="power" id="powerId" class="jForm">
	  <option value="Low">Low Power</option>
	  <option value="High" selected="selected">High Power</option>
	  <option value="QRP">QRP</option>
	</select>
	<p><b>Categories</b> (check all that apply)</p>
	<table>
	  <tr>
            <td class="catCol">
              <label>
		<input type="checkbox" name="expedition" value="County Expedition" id="expedition" class="jForm"/>
		County Expedition</label>
	    </td>
	    <td class="catCol" >
              <label>
		<input type="checkbox" name="youth" value="Youth" id="youth" class="jForm"/>
		Youth (under 18)</label>
            </td>
            <td class="catCol" >
              <label>
		<input type="checkbox" name="mobile" value="Mobile" id="mobile" class="jForm"/>
		Mobile Operation</label>
            </td>
	  </tr>
	  <tr>
            <td class="catCol">
              <label>
		<input type="checkbox" name="female" value="YL" id="yl" class="jForm"/>
		YL</label>
            </td>
            <td class="catCol">
              <label>
		<input type="checkbox" name="school" value="School" id="school" class="jForm"/>
		School</label>
            </td>
            <td class="catCol">
              <label>
		<input type="checkbox" name="new" value="New Contester" id="newcontester" class="jForm"/>
		New Contester</label>
            </td>
	  </tr>
	</table>
	<label for="commentId">Comments:</label><br>
	<textarea name="comments" id="commentId" cols="80" 
		  rows="5" class="jForm"></textarea><br>
        <button type="submit" id="submit" class="jForm">Submit</button>
	<p>* Indicates <strong>required</strong> fields.
      </form>
    </div>
    <div id="doneMsg" style="visibility: hidden;"><p><strong>Upload Completed!</strong></p></div>
    <div id="reminder" >
      <p>PLEASE NOTE: you should receive a brief confirmation of your log via email, and it is your responsibility to verify that your
	log has been received by checking the <a href="server/received.fcgi">CQP Logs Received page</a>.
      </p>
    </div>
  </div>
  <div id="tabs-2">
    <div id="step-1a">
      <p>Uploading a CQP Cabrillo file is as easy as 1, 2, 3.  Please complete all three steps to complete
	your contest entry.</p>
      <h1>Step 1: Cut-n-paste Cabrillo file</h1>
      <form id="cutnpaste" action="server/upload.fcgi" method="post" accept-charset="UTF-8">
	<label for="cabcontentId">Paste your log here:</label><br>
	<textarea name="cabcontent" id="cabcontentId" cols="100" wrap="soft"
		  rows="5" ></textarea><br>
	<button type="submit" id="cabsubmit">Submit</button>
      </form>
    </div>
    <div id="step-2a">
      <h1>Step 2: Review Cabrillo file</h1>
      <p>If there are errors, please fix the problems in your Cabrillo
      file on your computer and then upload the fixed Cabrillo
      file.</p>
    </div>
    <div id="step-3a">
      <h1>Step 3: Provide Supplemental information</h1>
      <form action="server/upload.fcgi" method="post" id="AltsupplementalForm"  accept-charset="UTF-8">
	<input type="hidden" name="logID" value="-1" id="AltlogDBId" class="jForma"/>
	<label for="AltcallsignId" class="inLabel">Callsign*:</label>
	<input type="text" name="callsign" value="" id="AltcallsignId" class="jForma"/><br />
	<label for="AltemailId" class="inLabel">Email*:</label>
	<input type="email" name="email" id="AltemailId" class="jForma"/><br/>
	<label for="AltconfirmId" class="inLabel">Confirm Email*:</label>
	<input type="email" name="confirm" id="AltconfirmId" class="jForma"/><br />
	<label for="AltphoneId" class="inLabel">Phone Number*:</label>
	<input type="text" name="phone" id="AltphoneId" class="jForma"/><br />
	<label for="AltsentQTHId" class="inLabel">Sent QTH:</label>
	<input type="text" name="sentQTH" id="AltsentQTHId" class="jForma"/><br />
	<label for="AltopclassId" class="inLabel">Entry class:</label>
	<select name="opclass" id="AltopclassId" class="jForma">
	  <option value="single">Single-op</option>
	  <option value="multi-single">Multi-single</option>
	  <option value="multi-multi" selected="selected">Multi-multi</option>
	</select>
	<select name="power" id="AltpowerId" class="jForma">
	  <option value="Low">Low Power</option>
	  <option value="High" selected="selected">High Power</option>
	  <option value="QRP">QRP</option>
	</select>
	<p><b>Categories</b> (check all that apply)</p>
	<table>
	  <tr>
            <td class="catCol">
              <label>
		<input type="checkbox" name="expedition" value="County Expedition" id="Altexpedition" class="jForma"/>
		County Expedition</label>
	    </td>
	    <td class="catCol" >
              <label>
		<input type="checkbox" name="youth" value="Youth" id="Altyouth" class="jForma"/>
		Youth (under 18)</label>
            </td>
            <td class="catCol" >
              <label>
		<input type="checkbox" name="mobile" value="Mobile" id="Altmobile" class="jForma"/>
		Mobile Operation</label>
            </td>
	  </tr>
	  <tr>
            <td class="catCol">
              <label>
		<input type="checkbox" name="female" value="YL" id="Altyl" class="jForma"/>
		YL</label>
            </td>
            <td class="catCol">
              <label>
		<input type="checkbox" name="school" value="School" id="Altschool" class="jForma"/>
		School</label>
            </td>
            <td class="catCol">
              <label>
		<input type="checkbox" name="new" value="New Contester" id="Altnewcontester" class="jForma"/>
		New Contester</label>
            </td>
	  </tr>
	</table>
	<label for="AltcommentId">Comments:</label><br>
	<textarea name="comments" id="AltcommentId" cols="80"
		  rows="5" class="jForma"></textarea><br>
        <button type="submit" id="Altsubmit" class="jForma">Submit</button>
	<p>* Indicates <strong>required</strong> fields.
      </form>
    </div>
    <div id="AltdoneMsg" style="visibility: hidden;"><p><strong>Upload Completed!</strong></p></div>
    <div id="Altreminder" >
      <p>PLEASE NOTE: you should receive a brief confirmation of your log via email, and it is your responsibility to verify that your
	log has been received by checking the <a href="server/received.fcgi">CQP Logs Received page</a>.
      </p>
    </div>
  </div>
</div>

<div id="AllInOne"> 
  <h1>Upload your CQP Load</h1>
  <form id="OneForm" action="server/upload.fcgi" method="post" accept-charset="UTF-8">
    <label for="ALLcabcontentId">Paste your log here:</label><br>
    <textarea name="cabcontent" id="ALLcabcontentId" cols="100" wrap="soft"
	      rows="5" ></textarea><br>
    <input type="hidden" name="logID" value="-1" id="ALLlogDBId" class="jFormb"/>
    <label for="ALLcallsignId" class="inLabel">Callsign*:</label>
    <input type="text" name="callsign" value="" id="ALLcallsignId" class="jFormb"/><br />
    <label for="ALLemailId" class="inLabel">Email*:</label>
    <input type="email" name="email" id="ALLemailId" class="jFormb"/><br/>
    <label for="ALLconfirmId" class="inLabel">Confirm Email*:</label>
    <input type="email" name="confirm" id="ALLconfirmId" class="jFormb"/><br />
    <label for="ALLphoneId" class="inLabel">Phone Number*:</label>
    <input type="text" name="phone" id="ALLphoneId" class="jFormb"/><br />
    <label for="ALLsentQTHId" class="inLabel">Sent QTH:</label>
    <input type="text" name="sentQTH" id="ALLsentQTHId" class="jFormb"/><br />
    <label for="ALLopclassId" class="inLabel">Entry class:</label>
    <select name="opclass" id="ALLopclassId" class="jFormb">
      <option value="single">Single-op</option>
      <option value="multi-single">Multi-single</option>
      <option value="multi-multi" selected="selected">Multi-multi</option>
    </select>
    <select name="power" id="ALLpowerId" class="jFormb">
      <option value="Low">Low Power</option>
      <option value="High" selected="selected">High Power</option>
      <option value="QRP">QRP</option>
    </select>
    <p><b>Categories</b> (check all that apply)</p>
    <table>
      <tr>
        <td class="catCol">
          <label>
	    <input type="checkbox" name="expedition" value="County Expedition" id="ALLexpedition" class="jFormb"/>
	    County Expedition</label>
	</td>
	<td class="catCol" >
          <label>
	    <input type="checkbox" name="youth" value="Youth" id="ALLyouth" class="jFormb"/>
	    Youth (under 18)</label>
        </td>
        <td class="catCol" >
          <label>
	    <input type="checkbox" name="mobile" value="Mobile" id="ALLmobile" class="jFormb"/>
	    Mobile Operation</label>
        </td>
      </tr>
      <tr>
        <td class="catCol">
          <label>
	    <input type="checkbox" name="female" value="YL" id="ALLyl" class="jFormb"/>
	    YL</label>
        </td>
        <td class="catCol">
          <label>
	    <input type="checkbox" name="school" value="School" id="ALLschool" class="jFormb"/>
	    School</label>
        </td>
        <td class="catCol">
          <label>
	    <input type="checkbox" name="new" value="New Contester" id="ALLnewcontester" class="jFormb"/>
	    New Contester</label>
        </td>
      </tr>
    </table>
    <label for="ALLcommentId">Comments:</label><br>
    <textarea name="comments" id="ALLcommentId" cols="80"
	      rows="5" class="jFormb"></textarea><br>
    <button type="submit" id="ALLsubmit" class="jFormb">Submit</button>
    <button type="reset" id="ALLreset" value="Reset" class="jFormb">Reset</button>
    <p>* Indicates <strong>required</strong> fields.
  </form>
    <div id="ALLreminder" >
      <p>PLEASE NOTE: you should receive a brief confirmation of your log via email, and it is your responsibility to verify that your
	log has been received by checking the <a href="server/received.fcgi">CQP Logs Received page</a>.
      </p>
    </div>
</div>

 
<script  type="text/javascript">
  $(function () {
    var urlval = "server/upload.fcgi";
    $('#tabs').show();
    $('#AllInOne').hide();
    $('#step-2').fadeTo(100, 0.4);
    $('.jForm').prop("disabled", true);
    $('#step-3').fadeTo(100, 0.4);
    $('#step-2a').fadeTo(100, 0.4);
    $('.jForma').prop("disabled", true);
    $('#step-3a').fadeTo(100, 0.4);
    $('#fileupload').fileupload({
        url: urlval,
        dataType: 'json',
        done: function (e, data) {
            console.log("Success 4");
            console.log(JSON.stringify(data.result))
            $('#progress .progress-bar').css(
                'width', '0%' );
            $.each(data.result.files, function (index, file) {
                console.log("File name = " + file.name)
                console.log("ID = " + file.id)
                $('#logDBId').val(file.id);
            });
            if (data.result.callsign) {
              $('#callsignId').val(data.result.callsign);
            }
            if (data.result.email) { 
              $('#emailId').val(data.result.email);
            }
            $('#step-1').fadeTo(100, 0.4);
            $('#fileupload').fileupload("disable");
            $('#step-2').fadeTo(100, 1.0);
            $('.jForm').prop("disabled", false);
            $('#step-3').fadeTo(100, 1.0);
            console.log("Done")
        },
        progressall: function (e, data) {
            var progress = parseInt(data.loaded / data.total * 100, 10);
            $('#progress .progress-bar').css(
                'width',
                progress + '%'
            );
        }
    }).prop('disabled', !$.support.fileInput)
        .parent().addClass($.support.fileInput ? undefined :
    'disabled');
    $( "#tabs" ).tabs({ active: 0});
    $( "#supplementalForm" ).validate({
       rules: {
         email: "required",
         confirm: {
           equalTo: "#emailId"
         }
       }
     });
    $("#supplementalForm" ).submit(function(ev) {
      var urlval = "server/upload.fcgi";
      $.ajax({
          type: "POST",
          url : urlval,
          data: $("#supplementalForm").serialize(),
          success: function(data) {
             console.log("Success 3");
             $("#logDBId").val("");
             $("#callsignId").val("");
             $("#emailId").val("");
             $("#confirmId").val("");
             $("#phoneId").val("");
             $("#sentQTHId").val("");
             $("#opclassId").val("multi-multi");
             $("#powerId").val("High");
             $("#commentId").val("");
             $("#expedition").prop("checked", false);
             $("#youth").prop("checked", false);
             $("#mobile").prop("checked", false);
             $("#yl").prop("checked", false);
             $("#school").prop("checked", false);
             $("#newcontester").prop("checked", false);
             $("#doneMsg").css("visibility", "visible");
             $('#step-1').fadeTo(100, 1.0);
             $('#fileupload').fileupload("enable");
             $('#step-2').fadeTo(100, 0.4);
             $('.jForm').prop("disabled", true);
             $('#step-3').fadeTo(100, 0.4);
          }
      });
      ev.preventDefault();
    });
    $( "#AltsupplementalForm" ).validate({
       rules: {
         email: "required",
         confirm: {
           equalTo: "#AltemailId"
         }
       }
     });
    $('#AltsupplementalForm').submit(function(ev) {
      var urlval = "server/upload.fcgi";
      $.ajax({
          type: "POST",
          dataType: "json",
          url : urlval,
          data: $("#AltsupplementalForm").serialize(),
          success: function(data) {
             console.log("Success 2");
             $("#AltlogDBId").val("");
             $("#AltcallsignId").val("");
             $("#AltemailId").val("");
             $("#AltconfirmId").val("");
             $("#AltphoneId").val("");
             $("#AltsentQTHId").val("");
             $("#AltopclassId").val("multi-multi");
             $("#AlpowerId").val("High");
             $("#AltcommentId").val("");
             $("#Altexpedition").prop("checked", false);
             $("#Altyouth").prop("checked", false);
             $("#Altmobile").prop("checked", false);
             $("#Altyl").prop("checked", false);
             $("#Altschool").prop("checked", false);
             $("#Altnewcontester").prop("checked", false);
             $("#AltdoneMsg").css("visibility", "visible");
             $('#step-1a').fadeTo(100, 1.0);
             $('#fileupload').fileupload("enable");
             $('#step-2a').fadeTo(100, 0.4);
             $('.jForma').prop("disabled", true);
             $('#step-3a').fadeTo(100, 0.4);
          },
          error: function(xhr, tstatus, errthrn)  {
             console.log("Error 2");
             console.log(xhr.responseText);
             console.log(tstatus);
             console.log(errthrn);
          }
      });
      ev.preventDefault();
    });

    $('#cutnpaste' ).submit(function(ev) {
      var urlval = "server/upload.fcgi";
      $.ajax({
          type: "POST",
          url : urlval,
          dataType: "json",
          data: $("#cutnpaste").serialize(),
          success: function(data) {
             console.log("Success 1");
             $('#step-1a').fadeTo(100, 0.4);
             $('#cabcontentId').val("");
             $('#step-2a').fadeTo(100, 1.0);
             $('.jForma').prop("disabled", false);
             $('#step-3a').fadeTo(100, 1.0);
             console.log(data);
             $.each(data.files, function (index, file) {
                console.log("ID = " + file.id)
                $('#AltlogDBId').val(file.id);
              });
              if (data.callsign) {
                $('#AltcallsignId').val(data.callsign);
              }
              if (data.email) { 
                $('#AltemailId').val(data.email);
              }
             $('#cabcontentId').prop("disabled", true);
             console.log("Success 1 done");
          },
          error: function(xhr, tstatus, errthrn)      {
             console.log("Error 1");
             console.log(xhr.responseText);
             console.log(tstatus);
             console.log(errthrn);
          }
      });
      ev.preventDefault();
    });
  });
</script>
</body>
</html>
